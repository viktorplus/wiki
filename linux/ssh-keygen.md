# ssh-keygen — шпаргалка

Коротко: `ssh-keygen` создаёт и управляет ключами SSH (генерация, просмотр fingerprint, конвертация, изменение пароля, удаление хост-ключей).
#ssh-keygen, #linux, #ssh
---

## Синтаксис

```
ssh-keygen [OPTIONS]
ssh-keygen -t ed25519 -C "comment" -f ~/.ssh/id_ed25519
ssh-keygen -l -f ~/.ssh/id_ed25519.pub
```

Без опций запускается интерактивный мастер создания пары ключей (по умолчанию `~/.ssh/id_rsa`).

## Часто используемые опции генерации

- `-t type` — тип ключа (`ed25519`, `rsa`, `ecdsa`, `dsa`)
- `-b bits` — размер ключа (для RSA обычно 4096)
- `-C comment` — комментарий (часто e-mail или метка устройства)
- `-f file` — путь для сохранения ключа
- `-N passphrase` — задать парольную фразу (пустая строка для безпарольного)
- `-q` — тихий режим (подавить подсказки)
- `-a rounds` — число раундов KDF (важно для защиты passphrase, рекомендуют ? 100)

## Управление существующими ключами

- `-l -f key.pub` — показать fingerprint
- `-E md5|sha256` — выбрать формат fingerprint
- `-y -f key` — вывести открытый ключ из приватного
- `-p -f key` — изменить парольную фразу
- `-m PEM -p -f key` — конвертировать формат приватного ключа
- `-e -f key` — экспортировать в формат RFC4716
- `-i -f key` — импортировать из RFC4716

## Работа с known_hosts

- `ssh-keygen -R host` — удалить записи о хосте из `~/.ssh/known_hosts`
- `ssh-keygen -H -f known_hosts` — хэшировать значения (анонимизация)
- `ssh-keygen -F host` — найти записи о хосте
- `ssh-keygen -r hostname -f key.pub` — создать DNS SSHFP-записи

## Типовые сценарии

- **Создать новый ключ Ed25519 с комментарием**:
  `ssh-keygen -t ed25519 -C "user@host" -f ~/.ssh/id_ed25519`
- **Создать RSA-ключ 4096 бит с паролем**:
  `ssh-keygen -t rsa -b 4096 -a 100 -f ~/.ssh/id_rsa`
- **Поменять пароль на приватном ключе**:
  `ssh-keygen -p -f ~/.ssh/id_ed25519`
- **Получить публичный ключ из приватного**:
  `ssh-keygen -y -f ~/.ssh/id_ed25519 > ~/.ssh/id_ed25519.pub`
- **Удалить устаревший ключ хоста**:
  `ssh-keygen -R old.example.com`
- **Показать fingerprint в SHA256**:
  `ssh-keygen -lf ~/.ssh/id_ed25519.pub -E sha256`

## Полезные приёмы

- Храните ключи в `~/.ssh/` с правами `600` (приватный) и `644` (публичный)
- Используйте `ssh-agent` для кэширования парольной фразы: `eval $(ssh-agent); ssh-add ~/.ssh/id_ed25519`
- Для корпоративных PKI может понадобиться `ssh-keygen -s ca -I identity` (подписание ключей)
- Добавляйте ключи на сервер через `ssh-copy-id` или вручную в `~/.ssh/authorized_keys`
- Регулярно проверяйте `known_hosts`, чтобы удалять устаревшие записи и избегать конфликтов fingerprint

## Справка

- `man ssh-keygen`
- OpenSSH manual: https://man.openbsd.org/ssh-keygen

---

???????? ? [??????? ????????](./README.md).

???????? ? [??????? ????????](./README.md).


Вернуться к [главной странице](./README.md).
