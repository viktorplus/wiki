# ps и списки процессов

Описание: `ps` показывает процессы, запущенные на системе, позволяет фильтровать и сортировать вывод для мониторинга.
#ps, #linux, #processes
---

## Базовый синтаксис

```
ps [OPTIONS]
ps -ef               # широкий формат через Unix
ps aux               # BSD-стиль (обычно используется вместе с grep)
ps -p PID            # конкретный PID
ps -u user           # процессы конкретного пользователя
ps -o pid,cmd,%cpu,%mem
```

## Важные ключи

- `a` — показать процессы всех пользователей, привязанные к терминалам.
- `x` — включать процессы без терминала (демоны).
- `u` — выводить подробные статистические поля (CPU, MEM, STAT, USER).
- `-f` — показывать дерево вызовов (PPID, COMMAND).
- `-o` — пользовательский формат (`ps -o pid,ppid,user,stat,cmd`).
- `--sort=KEY` — сортировка, например `--sort=-%cpu`.
- `-p PID` — указать PID для вывода.
- `-U user`/`-u user` — показать процессы по UID/имени.
- `-t tty` — фильтр по терминалу.

## Часто используемые шаблоны

- **Дерево процессов пользователя**:
  ```
  ps -u $USER -o pid,ppid,%cpu,%mem,stat,cmd --forest
  ```
- **Процессы с максимальным %CPU**:
  ```
  ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head
  ```
- **Проверить nginx**:
  ```
  ps -ef --forest | grep nginx
  ```
- **Найти процессы PostgreSQL**:
  ```
  ps aux | grep -i postgres | grep -v grep
  ```
- **Показать потомков заданного PID**:
  ```
  ps --ppid 1234 -o pid,cmd
  ```
- **Сумма памяти по пользователю**:
  ```
  ps -eo user,%mem --sort=-%mem | awk 'NR>1 {sum+=$2} END {print sum "%"}'
  ```
- **Поиск процессов, застрявших в D**:
  ```
  ps -eo pid,stat,cmd | awk '$2 ~ /D/ {print}'
  ```

## Альтернативы и дополнения

- `top` / `htop` дают интерактивный мониторинг (ps дает снимок на момент запуска).
- `pgrep`/`pkill` удобны для поиска и управления по шаблону.
- `pstree` показывает древовидное представление.
- `ps -C command -o pid=` возвращает PID процесса по имени.

## Советы

- `ps` полезен в скриптах для проверки наличия процесса перед запуском.
- Комбинируйте `ps` и `grep`/`awk` для получения только нужных полей.
- Используйте `ps --sort` с `head`, чтобы быстро найти самые «тяжелые» процессы.

## Ссылки

- `man ps`
- https://gitlab.com/procps-ng/procps

---


Вернуться к [главной странице](./README.md).
