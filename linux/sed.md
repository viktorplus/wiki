# sed в Linux

Описание: `sed` — потоковый редактор, который применяет набор команд к каждому входному буферу, заменяет текст и позволяет автоматизировать простые изменения.
#sed, #linux, #text
---

## Основы

```
sed [OPTIONS] 'script' [FILE...]
sed -e 's/foo/bar/' file.txt
sed -f commands.sed input.txt
```

Если файл не передан, `sed` читает stdin. Скрипт можно писать в кавычках или передавать через `-e`/`-f`.

## Полезные опции

- `-n` — подавляет автоматическую печать каждой строки (обычно используется с `p`).
- `-e script` — добавляет программную команду, можно использовать несколько раз.
- `-f file` — берет скрипт из файла.
- `-i[.bak]` — применяет изменения на месте, можно сохранить резервную копию с расширением.
- `-r`/`-E` — включает расширенные регулярные выражения (GNU sed).
- `-s` — читает файлы по очереди, не объединяя их.
- `-u` — использует неблокирующий вывод.

## Команды

- `p` — напечатать текущий буфер (часто используется с `-n`).
- `d` — удалить строку и перейти к следующей.
- `s/old/new/[flags]` — замена, флаги: `g`, `p`, `w filename`.
- `a \` — добавить строки после текущей.
- `i \` — вставить строки перед текущей.
- `c \` — заменить текущую строку.
- `y/source/dest/` — преобразовать символы, аналог `tr`.
- `q [code]` — завершить выполнение с кодом.
- `=` — вывести номер строки.
- `w file` и `r file` — записать и прочитать файл соответственно.
- `n`/`N` — перейти ко следующей строке с выводом/без.
- `g`, `G`, `h`, `H`, `x` — работа с hold space.

## Примеры

- **Замена одного совпадения**: `sed 's/foo/bar/' file`.
- **Глобальная замена**: `sed 's/foo/bar/g' file`.
- **Удалить пустые строки**: `sed '/^$/d' file`.
- **Удалить комментарии**: `sed '/^#/d' config.toml`.
- **Преобразовать табы**: `sed 's/\t/    /g' file`.
- **Вывести только ошибки**: `sed -n '/ERROR/p' logfile`.
- **Строки с 10 по 20**: `sed -n '10,20p' file`.
- **Перевернуть соседние строки**: `sed 'N; s/\(.*\)\n\(.*\)/\2\n\1/' file`.
- **Область между BEGIN и END**: `sed -n '/BEGIN/,/END/p' file`.

## Практические советы

- Пробуйте `sed -n '10p' file` для отладки и добавляйте `-n`.
- В скриптах удобно писать несколько команд внутри `{ ... }`.
- Комбинируйте `find ... -print0 | xargs -0 sed ...` для массовой обработки.
- Защитите `.` и `/` в регулярных выражениях, чтобы не повысить количество совпадений.

## Ресурсы

- `man sed`
- https://www.gnu.org/software/sed/manual/

---


Вернуться к [главной странице](./README.md).
