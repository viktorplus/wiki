# MySQL — Урок 9.1. Оконные функции: общие концепции

## Доступ к учебной БД (read-only)
- `hostname`: ich-db.edu.itcareerhub.de
- `username`: ich1
- `password`: password

---

## 1) Что такое оконная функция
**Оконная функция** — это функция, которая делает вычисления по набору строк (окну), связанному с *текущей строкой*, и возвращает **значение для каждой исходной строки**.

Ключевая мысль:
- **Агрегация с GROUP BY** “сворачивает” строки в группы → **одна строка на группу**.
- **Оконная функция** считает по группе/окну, но **не сворачивает результат** → **одна строка на каждую исходную строку**, плюс новая вычисленная колонка.

---

## 2) GROUP BY vs Оконные функции (коротко)
### GROUP BY
- **Цель:** сгруппировать строки по одному/нескольким столбцам и посчитать агрегаты по группам.
- **Результат:** 1 строка на 1 группу (строки внутри группы объединяются).

### Оконные функции
- **Цель:** посчитать агрегаты/метрики по “окну” строк для каждой строки.
- **Результат:** сохраняются все исходные строки, а результат оконной функции добавляется как **доп. столбец**.

---

## 3) Синтаксис оконных функций
Базовый шаблон:
```sql
SELECT
  column1,
  window_function() OVER (PARTITION BY column2 ORDER BY column3) AS result_column
FROM table_name;
```

### Расшифровка
- `window_function()` — функция, которая считается по окну (например, `AVG`, `SUM`, `COUNT` и т.д.).
- `OVER (...)` — задаёт **окно**: как разделять строки (partition) и как их упорядочивать (order).
- `PARTITION BY ...` — делит строки на группы “окон” по значению столбца(ов).
- `ORDER BY ...` — задаёт порядок строк внутри каждого окна перед вычислением.

---

## 4) Основные понятия (концепции окна)
### 4.1. Окно (Window)
Окно — это набор строк, по которому считается функция **для текущей строки**.
Окно может:
- охватывать **все строки** результата,
- или только часть — если задан `PARTITION BY` (и/или другие параметры окна).

### 4.2. PARTITION BY
- Делит данные на независимые “разделы” (partitions).
- Похоже на GROUP BY, но **без сворачивания строк**.

Модель: “таблица — это коробки, PARTITION BY — как упаковать по коробкам. Считаем отдельно внутри каждой коробки”.

### 4.3. ORDER BY
- Определяет порядок строк внутри каждого partition.
- Важно для оконных расчётов по времени/ранжированию.

---

## 5) Мини-пример из слайдов (идея)
Среднее значение `revenue` по каждому пользователю, оставаясь на уровне каждой записи:
```sql
SELECT
  user_id,
  event_dt,
  revenue,
  AVG(revenue) OVER (PARTITION BY user_id) AS user_avg
FROM events;
```

---

## 6) Практический смысл (когда окно “выручает”)
Оконные функции нужны, когда хочешь:
- показать значение строки **и одновременно** среднее/сумму/кол-во по группе,
- посчитать метрику “внутри группы” без потери строк (без свёртки GROUP BY),
- сделать ранжирование/нумерацию внутри группы (это будет в следующих темах).

---

## 7) Задание на закрепление (по уроку)
В Google Sheets выполнить задания по определению:
- **окон** (partition),
- **сортировки** (order),
- построение окон и понимание, какие строки попадают в “рамку” для каждой строки.
