# Урок 6. Переменные и системные переменные + менеджмент ресурсов/процессов (top, ps, kill)

## 1) Что такое переменные
**Переменная** — это хранилище данных (область памяти), у которой есть имя, и значение которой можно читать и менять в процессе работы.  
В Linux (как и в других Unix-подобных системах) переменные окружения используются, чтобы задавать поведение программ и окружение пользователя/системы.  
Часто переменные пишут **БОЛЬШИМИ БУКВАМИ** (это соглашение, но не обязательное).

---

## 2) Системные переменные (переменные окружения)
**Системные переменные** определяют:
- поведение системы и приложений,
- конфигурацию программ,
- параметры окружения пользователя (локаль, терминал, домашний каталог и т.д.).

Как они задаются:
- вручную пользователем,
- автоматически при запуске системы или входе пользователя,
- через глобальные конфиги, профили пользователя, init-скрипты и т.д.

Примеры:
- `PATH` — где ОС ищет исполняемые файлы
- `HOME` — домашний каталог
- `LANG` / `LC_*` — язык и локаль
- `TERM` — тип терминала

---

## 3) Переменная PATH
### 3.1. Что хранит PATH
`PATH` — это список каталогов, **разделённых двоеточием `:`**.  
Когда вы вводите команду, оболочка (shell) ищет исполняемый файл в каталогах `PATH` **слева направо**, пока не найдёт команду.

Примеры типичных каталогов:
- `/usr/local/bin`, `/usr/bin`, `/bin`, `/usr/sbin`, `/sbin` и др.

### 3.2. Посмотреть PATH
```bash
echo $PATH
```

### 3.3. Добавить свой каталог в PATH (пример)
Обычно добавляют в файлы настройки оболочки (например `~/.bashrc` или `~/.bash_profile`):
```bash
export PATH=/my/new/dir:$PATH
```

---

## 4) Работа с переменными: env, export, echo, unset

### 4.1. Посмотреть все переменные окружения
Команда `env` выводит список всех переменных окружения в текущей сессии:
```bash
env
```

В “песочнице” (примерные переменные и смысл):
- `SHLVL` — уровень оболочки (сколько раз запускалась оболочка внутри оболочки)
- `HOME` — домашний каталог
- `OLDPWD` — предыдущая директория
- `PAGER` — программа для просмотра текста (часто `less`)
- `PS1` — формат приглашения shell (prompt)
- `TERM` — тип терминала
- `PATH` — пути поиска команд
- `PWD` — текущая директория
- `TZ` — часовой пояс

### 4.2. Объявление/экспорт переменной
Команда `export` задаёт переменную окружения:
```bash
export MY_VAR=hello
export var=world
```

Получение значения (через `$`):
```bash
echo $MY_VAR $var
# hello world
```

Важно:
- Без `$` вы выведете просто текст `MY_VAR`, а не значение.
- Имя переменной **может быть и не в верхнем регистре** — просто принято писать большими.

### 4.3. Удаление переменной (unset)
Чтобы убрать переменную из окружения:
```bash
unset MY_VAR
```

---

## 5) Менеджмент ресурсов и управление процессами

### 5.1. top
`top` — интерактивный мониторинг ресурсов и процессов в реальном времени:
```bash
top
```

Ключевые термины:
- **Load Average (1, 5, 15 мин)** — среднее число процессов, ожидающих CPU.
- **PID** — идентификатор процесса.
- **PPID** — идентификатор родительского процесса (кто создал процесс).

### 5.2. ps
`ps` — показывает процессы “снимком” в момент запуска команды:
```bash
ps -ef
# или
ps aux
```

**Разница ps и top**:
- `ps` — статичный список (на данный момент),
- `top` — интерактивно и постоянно обновляется.

### 5.3. kill и killall (сигналы)
Команды для отправки сигналов процессам:

- Завершить процесс по PID:
  ```bash
  kill PID
  ```
- Завершить все процессы по имени:
  ```bash
  killall имя_процесса
  ```

Частые сигналы:
- **SIGTERM (15)** — “мягко завершить”, процесс может корректно закрыться:
  ```bash
  kill PID
  # или
  kill -15 PID
  ```
- **SIGKILL (9)** — “жёстко убить”, без шанса на корректное завершение:
  ```bash
  kill -9 PID
  ```
- **SIGINT (2)** — аналог Ctrl+C:
  ```bash
  kill -2 PID
  ```
- **SIGQUIT (3)** — прерывание + может создать core dump:
  ```bash
  kill -3 PID
  ```

⚠️ Важно: “убив” `sshd`, вы можете отключить себя/других от сервера.

---

## 6) Команды для быстрой диагностики системы

### 6.1. Диск
```bash
df
df -h
```

### 6.2. Память
```bash
free
free -m
```

### 6.3. Версия ОС
```bash
cat /etc/os-release
```

### 6.4. Информация о CPU
```bash
cat /proc/cpuinfo
```

---

## 7) Задание для закрепления (опасное, но полезное)
1) На сервере найти и отфильтровать все процессы `ssh`.
2) Выбрать PID процесса и остановить его через `kill`.

Пример поиска:
```bash
ps -ef | grep ssh
```

---

## 8) Домашнее задание (суть)
1) Зайти на учебный сервер `linux.itcareerhub.de`.
2) Объявить новую переменную: `ANDREW_VARIABLE=<имя_группы>` (где ANDREW заменить на своё имя).
   Пример:
   ```bash
   export VIKTOR_VARIABLE=GROUPNAME
   ```
3) По пути `/opt/ВАША_ГРУППА/ВАШЕ_ИМЯ` создать **скрытый** файл `.process_management` и:
   - a) записать дату (`date`)
   - b) дописать строку `Welcome to Amazon server`
   - c) дописать информацию об общем объёме RAM (например, `free`/`free -m`)
   - d) дописать **количество** процессов, запущенных под пользователем `root` (из списка процессов)
   - e) дописать информацию об объявленных переменных, отфильтровав так, чтобы осталась только ваша переменная из пункта 2
   - f) найти PID и PPID процесса `/usr/sbin/sshd -D`
   - g) записать в формате: `PID *** PPID *`

4) Прислать файл/скриншот/команды.

---

## Мини-шпаргалка “в одну строку”
- Список переменных: `env`
- Присвоить и экспортировать: `export NAME=value`
- Посмотреть значение: `echo $NAME`
- Удалить переменную: `unset NAME`
- Процессы: `top`, `ps -ef`, `ps aux`
- Завершить: `kill PID`, принудительно: `kill -9 PID`
