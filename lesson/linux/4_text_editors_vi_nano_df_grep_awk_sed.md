# Урок 4. Текстовые редакторы (vi и nano) + piping (df, grep, awk, sed)

## План урока
- Текстовый редактор **vi** (vim): режимы работы, базовые команды, практика. fileciteturn1file0  
- Текстовый редактор **nano**: интерфейс, выход, базовые действия. fileciteturn1file0  
- **Piping**: команды `df`, `grep`, `awk`, `sed` и цепочки преобразований. fileciteturn1file0turn1file1  

---

## 1) Vi / Vim — главное

### 1.1. Что такое vi/vim
- **vi** — один из самых популярных текстовых редакторов в UNIX/Linux.
- **vim** (Vi Improved) — улучшенный клон `vi`: больше возможностей, подсветка синтаксиса, плагины, многоуровневый undo и т.д. fileciteturn1file0turn1file1  

### 1.2. Режимы работы
В `vi` есть два базовых режима: fileciteturn1file0turn1file1  
- **Command mode (командный режим)** — клавиши = команды (перемещение, удаление, копирование/вставка).
- **Insert mode (режим вставки)** — обычный ввод/редактирование текста.

Переходы:
- `i` — перейти в Insert mode (начать ввод текста)
- `Esc` — вернуться в Command mode

### 1.3. Полезные команды vi (шпаргалка)
> Большинство команд выполняются **в командном режиме** (после `Esc`). fileciteturn1file0turn1file1  

| Команда | Что делает |
|---|---|
| `ZZ` (заглавные) | сохранить и выйти |
| `:w` | сохранить, но не выходить |
| `:wq` | сохранить и выйти |
| `:x` | сохранить и выйти (как `:wq`) |
| `:q!` | выйти без сохранения (отменить изменения) |
| `G` | перейти к последней строке файла |
| `/текст` + Enter | поиск по файлу, `n` — следующее совпадение |
| `u` | отменить последнее действие (undo) |
| `dd` | удалить текущую строку |
| `yy` | копировать текущую строку |
| `p` | вставить буфер после текущей строки |
| `Del` | удалить символ (вставка не требуется) |

### 1.4. Мини-практика vi (как на уроке)
1) Создать/открыть файл:
```bash
vi /tmp/file
```

2) Нажать `i` → написать, например:
```
Hello from ICH!
```

3) Нажать `Esc` → сохранить и выйти:
- вариант 1: `ZZ`
- вариант 2: `:wq` → Enter fileciteturn1file0  

4) Дописать дату в файл и снова открыть:
```bash
date >> /tmp/file
vi /tmp/file
```

5) Заменить `ICH` на своё имя, удалить строку с датой командой `dd`.  
Если ошибся — `u` (undo). fileciteturn1file0  

---

## 2) Nano — главное

### 2.1. Что такое nano
**nano** — простой консольный текстовый редактор:
- сразу открывается в режиме редактирования
- внизу есть подсказки по горячим клавишам
- часто удобен новичкам (не нужно привыкать к режимам как в vi) fileciteturn1file0turn1file1  

Запуск:
```bash
nano /tmp/file
```

### 2.2. Интерфейс и выход
- сверху: имя файла + версия
- снизу: подсказки (например `^X Exit`)
- выйти: **Ctrl + X** fileciteturn1file0turn1file1  

---

## 3) Piping: df, grep, awk, sed (цепочки обработки)

### 3.1. Задача из урока
Получить процент занятого места **на корневом разделе `/`** (например `47`), **без знака `%`**, и записать значение в файл `/tmp/df`. fileciteturn1file0turn1file1  

Готовая цепочка:
```bash
df -h | grep -w / | awk '{print $5}' | sed 's/%//g' > /tmp/df
```

### 3.2. Разбор каждой команды

#### `df`
Показывает использование дискового пространства.
- `df -h` — “human-readable” (К/М/Г). fileciteturn1file0turn1file1  

#### `grep`
Фильтрует строки по шаблону (поиск в файле или выводе другой команды). fileciteturn1file0turn1file1  

Типовые примеры:
```bash
grep "pattern" filename.txt
ls -l | grep "file"
```

Полезные ключи `grep`: fileciteturn1file0turn1file1  
- `-i` — игнорировать регистр
- `-v` — вывести строки, **не** содержащие совпадение
- `-w` — искать целое слово (очень важно в примере с `/`)
- `-r`/`-R` — рекурсивный поиск
- `-A N` — N строк после совпадения
- `-B N` — N строк до совпадения
- `-C N` — N строк вокруг совпадения

#### `awk`
Утилита и язык для обработки табличного текста: делит строку на поля/колонки и позволяет выбрать нужное. fileciteturn1file0turn1file1  

В нашей строке из `df -h` процент обычно в **5-й колонке**, поэтому:
```bash
awk '{print $5}'
```

#### `sed`
Stream Editor — делает текстовые замены в потоке. fileciteturn1file0turn1file1  

Замена “apple” на “orange”:
```bash
sed 's/apple/orange/g' filename.txt
```

В нашем случае убираем `%`:
```bash
sed 's/%//g'
```

⚠️ Перезаписать файл “на месте” (in-place) можно ключом `-i`:
```bash
sed -i 's/user2/Ivan/g' /etc/group
```
(использовать осторожно) fileciteturn1file0  

---

## 4) Задания для закрепления (из урока)

### 4.1. Vi — упражнение
1) `vi /tmp/file`  
2) Перейти в другой режим  
3) Написать `Hello from ICH!`  
4) Выйти из режима редактирования (`Esc`)  
5) Сохранить и выйти (`ZZ` или `:wq`)  
6) `date >> /tmp/file`, снова открыть `vi /tmp/file`  
7) Поменять `ICH` на своё имя, удалить строку с датой через `dd`  
8) Сохранить и выйти fileciteturn1file0turn1file1  

### 4.2. Vi + Nano — упражнение
1) Создать файл `/home/text_editors` (через `vi` и через `nano`)  
2) Добавить текст:
- `I love vi`
- `I love nano` fileciteturn1file0turn1file1  

### 4.3. Тест-вопрос (найдите неверное утверждение)
1) Поток №2 — поток данных, которые оболочка выводит после выполнения каких-то действий.  
2) Grep — это функция поиска по символам.  
3) awk — простая, но мощная утилита, которая анализирует текст и плавно преобразует его.  
4) df — команда, показывающая насколько занят диск. fileciteturn1file0turn1file1  

---

## 5) Практическая работа (команды)
Задание: fileciteturn1file0turn1file1  
1) Создать файл `myfile.txt` по пути `/root/test3/`  
2) Записать в него вывод `df -h`  
3) Дописать 9 первых строк из списка объектов корня `/`  
4) Дописать в файл **количество символов** из трёх последних строк `/etc/group`

Реализация (как на слайдах):
```bash
mkdir -p /root/test3
df -h > /root/test3/myfile.txt
ls -a / | head -9 >> /root/test3/myfile.txt
cat /etc/group | tail -3 | wc -m
```

> Если нужно именно **дописать число** (п.4) в файл:
```bash
cat /etc/group | tail -3 | wc -m >> /root/test3/myfile.txt
```

---

## 6) Домашнее задание (JSLinux)
Сделать в JSLinux: fileciteturn1file1  
1) Записать в новый файл дату  
2) Дописать информацию о занятом пространстве корневого раздела `/`  
3) Дописать три последних команды из истории  
4) Дописать строки из `/etc/passwd`, отфильтровав так, чтобы остались только строки со словом `cron`  
5) Дописать количество строк со словом `root` из `/etc/group`  
6) В текстовом редакторе добавить второй строкой фразу: `Modified with text editor`  
7) Экспортировать и отправить итоговый файл (команда `export_file`)

---

## Мини-шпаргалка “что помнить”
- **vi**: режимы (`i` / `Esc`), выход (`ZZ` / `:wq` / `:q!`), правки (`dd`, `yy`, `p`, `u`, `/`). fileciteturn1file0  
- **nano**: редактирование сразу, выход `Ctrl+X`. fileciteturn1file0  
- **pipe**: `команда1 | команда2` (stdout → stdin), частая связка `df | grep | awk | sed`. fileciteturn1file0turn1file1  
