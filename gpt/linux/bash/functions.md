# Bash функции — шпаргалка

Коротко: функции делают скрипты читаемыми и повторно используемыми; возвращают коды и могут принимать параметры.
#bash, #functions, #shell
---

## Синтаксис

```bash
my_func() {
  local arg="$1"
  echo "Hello $arg"
}

main() {
  local target="world"
  my_func "$target"
}

main "${@}" 
```

`()` можно опустить, но нужно сохранять пробелы (`function_name () { ...; }`).

## Параметры

- `$1`, `$2` и т. д. — аргументы функции.
- `$@` — все аргументы, безопасно `"${@}"`.
- `shift` — смещает аргументы: `shift 2`.
- `local` — ограничивает переменные внутри функции (`local user="$1"`).
- `readonly` — для констант `local -r version=1.0`

## Возврат кода

- Используйте `return 0` / `return 1` внутри функций.
- Можно возвращать статус команды: `command && return 0 || return 1`.
- `set -euo pipefail` (см. script-guidelines и error-handling) поможет ловить ошибки.

## Документация

Рекомендуется комментировать функции:
```bash
# Загружает конфиг и возвращает путь
load_config() { ... }
```

## Утилиты

- `declare -F` — список функций.
- `type func_name` — показать определение.

## Советы

- Разделяйте `main()` и вызов в конце файла, чтобы можно было source-ить скрипт без выполнения.
- При написании модульных скриптов делайте `if [[ ${BASH_SOURCE[0]} == ${0} ]]; then main "${@}"; fi`.
- Используйте `return` в helper-функциях вместо `exit`, чтобы не завершить весь скрипт.
- Для глобального состояния добавляйте `readonly BASE_DIR` и передавайте в функции как аргумент.

## Ресурсы

- `help function`
- https://www.gnu.org/software/bash/manual/bash.html#Shell-Functions

---

Вернуться к [главной странице](../README.md).
