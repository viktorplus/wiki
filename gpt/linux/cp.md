# cp — шпаргалка

Коротко: `cp` копирует файлы или директории; при необходимости можно сохранять метаданные, сохранять структуру путей и избегать перезаписи.
#cp, #linux, #filesystem
---

## Синтаксис

```
cp [OPTIONS] SOURCE... DEST
cp file.txt ~/backup/
cp -r project/ /srv/www/
```

Если `DEST` — директория, файлы копируются внутрь. При нескольких источниках `DEST` должен быть каталог.

## Важные опции

- `-r` / `-R` — копировать рекурсивно (каталоги и их содержимое)
- `-a` — архивное копирование (`-r`, сохраняет права, символьные ссылки, временные метки)
- `-i` — интерактивно спрашивать перед перезаписью
- `-n` — не перезаписывать существующие файлы (no-clobber)
- `-u` — копировать только если источник новее назначения
- `-v` — вывод действий (verbose)
- `-p` — сохранять права/владельца/временные метки
- `--parents` — копировать с указанием вышеуровневых директорий (`cp --parents src/dir/file dest/`)
- `--backup[=CONTROL]` — сохранять старые версии (зависит от `--suffix`)
- `-S SUFFIX` / `--suffix=SUFFIX` — суффикс для резервных копий (`.~1~`)
- `--preserve=context` — сохранять контекст (SELinux)
- `--reflink=auto|never|always` — использовать copy-on-write (если FS поддерживает)

## Примеры

- Рекурсивно копировать проект с сохранением атрибутов:
  ```
  cp -a project/ /mnt/backups/project/
  ```
- Копировать, не перезаписывая:
  ```
  cp -n config.example config
  ```
- Скопировать файл с указанием родительских каталогов:
  ```
  cp --parents src/app/main.py /tmp/restore/
  ```
- Обновить конфиг только при новых изменениях:
  ```
  cp -u new.conf /etc/app/config
  ```
- Скопировать список файлов через `xargs`:
  ```
  cat list.txt | xargs -I{} cp {} /tmp/archive/
  ```
- Протестировать `reflink` (на Btrfs, XFS):
  ```
  cp --reflink=always large.img /mnt/fast/
  ```

## Советы

- Для бэкапов используйте `cp -a`, чтобы не потерять права/символьные ссылки/времена.
- Если важен временной метки и владельцы, добавьте `-p` или `-a`.
- `cp -v` полезно в скриптах, когда нужно логировать, какие файлы копируются.
- Вместо `cp -r` для каталога, содержащего символьные ссылки, используйте `cp -a` (сохранит ссылки, не разворачивая).
- На больших данных иногда выгоднее `rsync -a --progress`, но `cp` проще для одноразовых копий.
- Если копируете в `/tmp` или `/var/tmp`, проверьте права `umask`, чтобы не получить `000`.

## Ссылки

- `man cp`
- GNU Coreutils: https://www.gnu.org/software/coreutils/cp

---

Вернуться к [главной странице](./README.md).
